{% extends 'base.html.twig' %}

{% block body %}

{% if selectedchild is null or selectedchild is empty  %}
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
   <h4 class="alert-heading">Enfant non selectionné</h4>
   <p>Vous devez choisir un enfant dans le menu</p>
    <ul class="list-group list-group-horizontal mx-auto" style="width: 350px;">
      {% for child in children %}
      <li class="list-group-item list-group-item-danger list-group-item-action">
        <a class="nav-link" aria-current="page" href="{{ path('app_home_child', {id: child.id}) }}">{{child}} ({{ child.points }})</a>
      </li>
      {% endfor %}
    </ul>
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% else %}
  {% for date,histos in historics %}
    <ul class="list-group"> 
      <li class="list-group-item">{{date}}</li>
      {% for historic in histos %}
        {# Déterminer le style selon la tâche ou l'ajustement manuel #}
        {% set item_style = 'list-group-item-light' %}
        {% if historic.task is not null %}
          {% set item_style = 'list-group-item-success' %}
          {% if historic.task.type == 1 %}
            {% set item_style = 'list-group-item-danger' %}
          {% endif %}
          {% if historic.task.type == 2 %}
            {% set item_style = 'list-group-item-warning' %}
          {% endif %}
        {% else %}
          {% if historic.points is defined and historic.points is not null %}
            {% if historic.points < 0 %}
              {% set item_style = 'list-group-item-danger' %}
            {% elseif historic.points > 0 %}
              {% set item_style = 'list-group-item-success' %}
            {% endif %}
          {% endif %}
        {% endif %}

        <li class="list-group-item  {{ item_style }}">
            <div class="container text-center">
              <div class="row">
                <div class="col text-start">
                 {{ historic.task ?? historic.description ?? 'Ajustement manuel' }}
                </div>
                <div class="col text-end">
                 {% set pts = historic.task ? historic.task.points : (historic.points ?? 0) %}
                 {% set badge = 'secondary' %}
                 {% if historic.task is not null %}
                   {% set badge = historic.task.type == 0 ? 'success' : (historic.task.type == 1 ? 'danger' : 'warning') %}
                 {% else %}
                   {% if pts > 0 %}{% set badge = 'success' %}{% elseif pts < 0 %}{% set badge = 'danger' %}{% else %}{% set badge = 'secondary' %}{% endif %}
                 {% endif %}

                 <span class="badge rounded-pill text-bg-{{ badge }}">{% if pts > 0 %}+{{ pts }}{% else %}{{ pts }}{% endif %}</span>
                 &nbsp; {{ historic.createdAt|date("d/m/Y H:i:s") }}
                </div>
              </div>
            </div>
        </li>
        {% endfor %}
  </ul>
  <div class='clearfix'>&nbsp;</div>
{% endfor %}

{% endif %}
{% endblock %}
